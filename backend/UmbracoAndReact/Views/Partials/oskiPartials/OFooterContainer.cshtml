@using System.Globalization
@using Umbraco.Cms.Core
@using File = System.IO.File
@inject IPublishedContentQuery ContentQuery
@inherits UmbracoViewPage<OHome>
@{
    var rootNode = ContentQuery.ContentAtRoot().FirstOrDefault();
    var posts = new List<PublishedContentModel>();

    if (rootNode != null)
    {
        var oBlogs = rootNode.Children<OBlog>();
        if (oBlogs != null)
        {
            var mostRecentItems = oBlogs
                .SelectMany(oBlog => oBlog.Children<OBlogpost>()
                .OrderByDescending(item => item.CreateDate)
                .Take(2))
                .ToList();
            var _mostRecentItems = oBlogs
                .SelectMany(oBlog => oBlog.Children<BlockGridPage>()
                    .OrderByDescending(item => item.CreateDate)
                    .Take(2))
                 .ToList();

            posts.AddRange(mostRecentItems);
            posts.AddRange(_mostRecentItems);

            posts = posts.OrderByDescending(item => item.CreateDate).Take(2).ToList();

        }
    }

    const string oskiHostName = "oski.site";
    var logoFooter = Model.OFooterLogo != null ? Model.OFooterLogo.Url() : string.Empty;
    var year = DateTime.Now.Year;
    var currentVersion = typeof(InstallLog).Assembly.GetName().Version;
    var privacyPolicy = Model.PrivacyPolicy == null ? string.Empty : Model.PrivacyPolicy.Url;
    var host = Context.Request.Host.Value;

    var cultureCode = UmbracoContext.PublishedRequest.PublishedContent;
    string selectedLanguage = "en-us";
    @foreach (var (culture, infos) in cultureCode.Cultures)
    {
        if (cultureCode.GetCultureFromDomains().ToLower().Equals(culture))
        {
            selectedLanguage = new CultureInfo(culture).IetfLanguageTag;
            continue;
        }
    }
    CultureInfo cultureInfo = new CultureInfo(selectedLanguage);
}
<footer class="footer">
    @if (!Model.OHideContactsArea)
    {
        <div class="footer__content">
            <div class="container">
                <div class="footer__block">
                    @if (posts != null)
                    {
                        <div class="footer__services">
                            <h4 class="footer__services-title">@Umbraco.GetDictionaryValue("BlogPost.FromOurBlog", "From Our Blog")</h4>
                            <ul class="footer__services-menu">
                                @foreach (var blog in posts)
                                {
                                    var fancyPublishDate = @Umbraco.GetDictionaryValue("BlogPost.Published", "Published: ") + blog.UpdateDate.ToString("MMMM d, yyyy");
                                    var cultureLetters = cultureInfo.TwoLetterISOLanguageName == "et" ? "ee" : cultureInfo.TwoLetterISOLanguageName;
                                    var link = blog.Url();
                                    <li>
                                        <a href="@link" class="footer__blog-link">@blog.Name</a>
                                    </li>
                                    <li>
                                        <a class="footer__blog-published-date">@fancyPublishDate</a>
                                    </li>
                                }
                            </ul>
                        </div>
                    }
                    <div class="footer__services">
                        @{
                            IEnumerable<OListBlock> oServiceListBlock = Model.OServices.Select(item => item.Content).Cast<OListBlock>();

                            var oServiceItem = oServiceListBlock.FirstOrDefault();
                            var oServiceLinks = oServiceItem.OItems.Select(item => item.Content);
                        }
                        <h4 class="footer__services-title">@oServiceItem.OTitle</h4>
                        <ul class="footer__services-menu">

                            @foreach (Link link in oServiceLinks)
                            {
                                var url = link?.OLink?.FirstOrDefault()?.Url ?? "#";
                                <li class="services-menu--margin">
                                    <a href="@url" class="footer__services-link">@link.OTitle</a>
                                </li>
                            }
                        </ul>
                    </div>
                    <nav class="footer__services">
                        @{
                            IEnumerable<OListBlock> oFooterNavigation = Model.OFooterNavigation.Select(item => item.Content).Cast<OListBlock>();

                            var oFooterNavigationItem = oFooterNavigation.FirstOrDefault();
                            var oFooterLinks = oFooterNavigationItem.OItems.Select(item => item.Content);
                        }
                        <h4 class="footer__services-title">@oFooterNavigationItem.OTitle</h4>
                        <ul class="footer__navigation-menu">
                            @foreach (Link link in oFooterLinks)
                            {
                                var url = link?.OLink?.FirstOrDefault()?.Url ?? "#";
                                <li class="services-menu--margin">
                                    <a href="@url" class="footer__navigation-link">@link.OTitle</a>
                                </li>
                            }
                        </ul>
                    </nav>
                    <div class="footer__contacts">
                        @{
                            IEnumerable<OContactList> oContacts = Model.OContacts.Select(item => item.Content).Cast<OContactList>();

                            var oContactsItem = oContacts.FirstOrDefault();
                            var addressItems = oContactsItem.OItems;
                            var contactLinks = oContactsItem.OLinks;
                        }
                        <h4 class="footer__contacts-title">@oContactsItem.OTitle</h4>
                        @foreach (var str in addressItems)
						{
                            <p class="footer__contacts-address">@str</p>
                        }

                        @foreach (Link link in oContactsItem.OLinks.Cast<Link>())
                        {
                             var url = link?.OLink?.FirstOrDefault()?.Url ?? "#";
                             <a href="@url" class="footer__contacts-link">@link.OTitle</a> 
                        }

                        <div class="footer__info-socials">
                            @foreach (SocialLink link in Model.OSocialLinks.Select(item => item.Content))
                            {
                                var linkUrl = link?.OUrl.FirstOrDefault()?.Url ?? "#";
                                <a href="@linkUrl" target="@(link?.OUrl.FirstOrDefault().Target)" class="footer__info-link">
                                    @Html.Raw(File.ReadAllText("wwwroot" + link.OIcon.Url()))
                                </a>
                            }
                        </div>
                    </div>
                   
                </div>
            </div>
        </div>
    }
    <div class="footer__copyright">
        <div class="container">
            <p class="footer__copyright-text">
                @year -
         
                This site is running Umbraco version @currentVersion. <a href="@privacyPolicy">Privacy Policy</a>
            </p>
        </div>
    </div>
</footer>